var Nodes={density:6,drawDistance:1,baseRadius:2,maxLineThickness:4,reactionSensitivity:4,lineThickness:5,scaleX:.5,scaleY:.5,points:[],mouse:{x:-1e3,y:-1e3,down:!1},animation:null,canvas:null,context:null,imageInput:null,bgImage:null,bgCanvas:null,bgContext:null,bgContextPixelData:null,stage:new PIXI.Container,manager:null,renderer:null,texture:null,newmouse:null,theta:null,blackhole:!1,mouseDisabled:!1,siteWidth:window.innerWidth,siteHeight:window.innerHeight,headerHeight:null,is_firefox:navigator.userAgent.toLowerCase().indexOf("firefox")>-1?!1:!0,isLoaded:!1,currentNum:0,multipleInit:function(e){Nodes.particleLoop(e,"next")},particleLoop:function(e,t){var n=e.length-1;1==Nodes.isLoaded&&(document.body.removeChild(Nodes.renderer.view),Nodes.stage.removeChildren(),cancelAnimationFrame(Nodes.animation),$("#bgCanvas").remove()),Nodes.init(e[Nodes.currentNum].drawnImage,e[Nodes.currentNum].particleDensity,e[Nodes.currentNum].particleWidth,e[Nodes.currentNum].particleHeight),Nodes.isLoaded=!0,"prev"==t?0==Nodes.currentNum?Nodes.currentNum=n:Nodes.currentNum>n||Nodes.currentNum--:Nodes.currentNum<n?Nodes.currentNum++:Nodes.currentNum==n&&(Nodes.currentNum=0)},init:function(e,t,n,r){var i={transparent:!0};this.scaleX=n,this.scaleY=r,this.headerHeight=$("#header").outerHeight(!0),this.siteHeight=window.innerHeight-Nodes.headerHeight,this.density=this.siteWidth>480?parseInt(t):7,0==Nodes.isLoaded&&(this.renderer=PIXI.autoDetectRenderer(this.siteWidth,this.siteHeight,i)),this.manager=this.renderer.plugins.interaction,document.body.appendChild(this.renderer.view),this.texture=PIXI.Texture.fromImage('header_index_files/money.png'),this.newmouse=this.manager.mouse,this.newmouse.global.x=-1e3,this.newmouse.global.y=-1e3,window.onresize=function(){Nodes.headerHeight=$("#header").outerHeight(!0),Nodes.siteWidth=window.innerWidth,Nodes.siteHeight=window.innerHeight-Nodes.headerHeight,Nodes.onWindowResize()},$(this.renderer.view).mousedown(function(){Nodes.blackhole=!0}),$(this.renderer.view).mouseup(function(){Nodes.blackhole=!1}),this.stage.interactive=!0,Nodes.stage.touchmove=Nodes.onTouchMove,window.addEventListener("touchend",Nodes.onTouchEnd),window.addEventListener("mouseout",Nodes.onTouchEnd),this.loadData(e),Nodes.newmouse.global.x=this.siteWidth/2,Nodes.newmouse.global.y=this.siteHeight/2,Nodes.blackhole=!0,Nodes.reactionSensitivity=-100,setTimeout(function(){Nodes.mouseDisabled=!0,Nodes.newmouse.global.x=-1e3,Nodes.newmouse.global.y=-1e3,Nodes.blackhole=!1,Nodes.reactionSensitivity=6},1e3)},preparePoints:function(){this.points=[];var e,t,n=this.bgContextPixelData.data;for(e=0;e<this.siteHeight;e+=this.density)for(t=0;t<this.siteWidth;t+=this.density){var r=4*(t+e*this.bgContextPixelData.width);if(!(n[r]>200&&n[r+1]>200&&n[r+2]>200||0===n[r+3])){var i="rgba("+n[r]+","+n[r+1]+","+n[r+2]+",1)";this.points.push({x:t,y:e,originalX:t,originalY:e,color:i})}}},updatePoints:function(){var e,t,n;for(this.reactionSensitivity=1==this.blackhole?-10:1==this.blowup?300:1==this.isNear()?6:0,e=0;e<this.stage.children.length;e++)originalPoint=this.points[e],t=this.stage.children[e],this.theta=Math.atan2(t.position.y-this.newmouse.global.y,t.position.x-this.newmouse.global.x),n=100*this.reactionSensitivity/Math.sqrt((this.newmouse.global.x-t.position.x)*(this.newmouse.global.x-t.position.x)+(this.newmouse.global.y-t.position.y)*(this.newmouse.global.y-t.position.y)),this.stage.children[e].position.x+=Math.round(100*(Math.cos(this.theta)*n+.05*(originalPoint.originalX-t.position.x)))/100,this.stage.children[e].position.y+=Math.round(100*(Math.sin(this.theta)*n+.05*(originalPoint.originalY-t.position.y)))/100},isNear:function(){var e=this.siteWidth,t=(this.siteHeight,this.newmouse.global.x),n=(this.newmouse.global.y,this.bgImage.width),r=(this.bgImage.height,e/2-n/2-e/10),i=e/2+n/2+e/10;return t>r&&i>t},drawPoints:function(){this.renderer.render(this.stage)},draw:function(){this.animation=requestAnimationFrame(function(){Nodes.draw()}),this.updatePoints(),this.drawPoints()},clear:function(){this.canvas.width=this.canvas.width},loadData:function(e){this.bgImage=new Image,this.bgImage.crossOrigin="anonymous",this.bgImage.src=e,this.bgImage.onload=function(){Nodes.drawImageToBackground()}},drawImageToBackground:function(){this.bgCanvas=document.createElement("canvas"),this.bgCanvas.setAttribute("id","bgCanvas"),this.bgCanvas.width=this.siteWidth,this.bgCanvas.height=this.siteHeight;var e,t;if(this.bgImage.width>this.bgCanvas.width-100||this.bgImage.height>this.bgCanvas.height-100){var n=Math.max(this.bgImage.width/this.bgCanvas.width,this.bgImage.height/this.bgCanvas.height);e=this.bgImage.width/n,t=this.bgImage.height/n}else e=this.bgImage.width,t=this.bgImage.height;Nodes.bgContext=Nodes.bgCanvas.getContext("2d"),Nodes.bgContext.drawImage(Nodes.bgImage,(Nodes.siteWidth-e)/2,(Nodes.siteHeight-t)/2,e,t),Nodes.bgContextPixelData=Nodes.bgContext.getImageData(0,0,Nodes.bgCanvas.width,Nodes.bgCanvas.height),Nodes.preparePoints(),Nodes.draw(),Nodes.drawPixies()},drawPixies:function(){var e,t;for(e=0;e<this.points.length;e++){t=this.points[e];var n=new PIXI.Sprite(this.texture);n.scale=new PIXI.Point(this.scaleX,this.scaleY),n.interactive=!0,n.anchor.x=.5,n.anchor.y=.5,n.position.x=t.x,n.position.y=t.y,Nodes.stage.addChild(n)}},onTouchEnd:function(){Nodes.newmouse.global.x=-1e3,Nodes.newmouse.global.y=-1e3},onTouchMove:function(e){1==Nodes.mouseDisabled&&(Nodes.newmouse.global.x=e.data.global.x,Nodes.newmouse.global.y=e.data.global.y)},mouseDown:function(){Nodes.reactionSensitivity=-10,Nodes.mouse.down=!0},mouseUp:function(){Nodes.reactionSensitivity=6,Nodes.mouse.down=!1},onWindowResize:function(){this.stage.removeChildren(),cancelAnimationFrame(this.animation),this.renderer.resize(this.siteWidth,this.siteHeight),this.drawImageToBackground()}};
